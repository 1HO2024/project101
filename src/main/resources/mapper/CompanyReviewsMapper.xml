<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.picktalk.mapper.CompanyReviewsMapper">
   
   <!-- 모든 리뷰 목록 조회 -->
   <select id="getAllreviews">
        SELECT 
           * 
        FROM 
           COMPANY_REVIEWS
        ORDER BY REVIEW_DATE DESC
       OFFSET #{start} ROWS FETCH NEXT #{size} ROWS ONLY
    </select>
    
    <!-- 총 게시글 수 조회 -->
    <select id="getTotalreviewsCount">
        SELECT 
           COUNT(*) 
        FROM 
           COMPANY_REVIEWS
    </select>
   
   <!-- 리뷰 추가 -->
    <insert id="insertreview">
        INSERT INTO COMPANY_REVIEWS (USER_ID, COMPNAME, RATING, DIFFICULTY, MOOD, TITLE, CONTENT, REVIEW_DATE)
        VALUES (#{user_id}, #{compname}, (#{difficulty} + #{mood}) / 2.0, #{difficulty}, #{mood}, #{title}, #{content}, SYSDATE)
   </insert>
    
    <!-- 리뷰 아이디 가져오기 -->
    <select id="getReviewById">
       SELECT 
          * 
       FROM 
          COMPANY_REVIEWS 
       WHERE 
          REVIEW_ID = #{review_id}
   </select>

   <!-- 리뷰 수정 -->
   <update id="updateReview">
       UPDATE 
           COMPANY_REVIEWS
       SET 
           COMPNAME = #{compname},
           RATING = (#{difficulty} + #{mood}) / 2.0,
           DIFFICULTY = #{difficulty},
           MOOD = #{mood},
           TITLE = #{title},
           CONTENT = #{content},
           REVIEW_DATE = SYSDATE
       WHERE 
           REVIEW_ID = #{review_id}
   </update>
   
   <!-- 리뷰 삭제 -->
   <delete id="deleteReview">
       DELETE FROM 
          COMPANY_REVIEWS 
       WHERE 
          REVIEW_ID = #{review_id}
   </delete>
   
   <!-- 기업마다 총 리뷰 조회 -->
   <select id="getTotalReviewsCount">
        SELECT COUNT(*) AS totalReviews
        FROM COMPANY_REVIEWS
        WHERE compname = #{compname}
   </select>
    
    <!-- 검색 -->
    <select id="findsearch">
    SELECT
       REVIEW_ID,
       USER_ID,
       COMPNAME,
       RATING,
       CONTENT,
       REVIEW_DATE,
       TITLE
      FROM
          COMPANY_REVIEWS
    WHERE 
       COMPNAME LIKE #{searchCompname}
    </select>
</mapper>
